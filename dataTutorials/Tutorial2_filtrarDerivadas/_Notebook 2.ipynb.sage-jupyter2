{"type":"settings","kernel":"python3","backend_state":"running","trust":true,"metadata":{"language_info":{"codemirror_mode":{"name":"ipython","version":3},"file_extension":".py","mimetype":"text/x-python","name":"python","nbconvert_exporter":"python","pygments_lexer":"ipython3","version":"3.5.2"}},"kernel_usage":{"cpu":0,"memory":79360000},"kernel_state":"idle"}
{"type":"file","last_load":1510589692442}
{"exec_count":9,"start":1511806988862,"input":"derivada_voltaje = derive_signal(waveData,1/sampleRate);","state":"done","pos":19,"cell_type":"code","type":"cell","end":1511806998416,"id":"5afa37","kernel":"python3"}
{"output":{"0":{"name":"stdout","text":"There is 1 channel.\nThe sampling rate is 44100 Hz.\n"}},"exec_count":6,"start":1511806981110,"input":"numChannels = record1.getnchannels() #número de canales\nsampleRate = record1.getframerate()  #frecuencia de muestreo\nsampleWidth = record1.getsampwidth()\nnumFrames = record1.getnframes() \n\nprint('There is %d channel.' % (numChannels))\nprint('The sampling rate is %d Hz.' % (sampleRate))","state":"done","pos":11,"cell_type":"code","type":"cell","end":1511806981138,"id":"a81e38","kernel":"python3"}
{"exec_count":1,"start":1511806973280,"input":"# show figures\n%matplotlib inline","state":"done","pos":2,"cell_type":"code","type":"cell","end":1511806973298,"id":"dc5e74","kernel":"python3"}
{"output":{"0":{"data":{"text/markdown":"<font color='red'>**Jupyter Kernel terminated:**</font> This might be caused by running out of memory or hitting a bug in some library (e.g., forking too many processes, trying to access invalid memory, etc.). Consider restarting or upgrading your project or running the relevant code directly in a terminal to track down the cause, as [explained here](https://github.com/sagemathinc/cocalc/wiki/KernelTerminated)."}}},"exec_count":10,"start":1511807000331,"input":"fig = plt.figure(figsize=(20, 5), dpi=100)\nplt.figure(1)\nplt.title('Electromiograma')\nplt.xlabel(r'tiempo [s]')\nplt.ylabel(r'$\\frac{dV}{dt}$ [$\\frac{$\\mu$V}{s}$]')\n\nplt.plot(derivada_voltaje)\n#plt.xlim(0,max(tiempo))\nplt.show()","scrolled":true,"state":"done","pos":20,"cell_type":"code","type":"cell","end":1511807001216,"id":"31da2a","kernel":"python3"}
{"output":{"0":{"data":{"text/plain":"[<matplotlib.lines.Line2D at 0x7f9f5d0c6a58>]"},"exec_count":9},"1":{"data":{"image/png":"4bdd26d94f9253b94f89ffc7f11c43f235dbc103"}}},"exec_count":9,"start":1511803563224,"input":"filtered = df[(df[\"Amplitud\"]>400)] #selecciona amplitudes mayores a 400 microvolts\nplt.plot(filtered['Tiempo'],filtered['Amplitud'])","scrolled":true,"state":"done","pos":24,"cell_type":"code","type":"cell","end":1511803564493,"id":"dce2f4","kernel":"python3"}
{"type":"cell","id":"4f8bb5","pos":1,"input":"# Tutorial 2. Discriminar amplitudes de forma simple y cómo obtener derivadas de los datos.\n### Noel Isaías Plascencia-Díaz, Marco Arieli Herrera-Valdez,\n### Facultad de Ciencias, UNAM\n\n","cell_type":"markdown"}
{"output":{"0":{"data":{"text/html":"<div>\n<style>\n    .dataframe thead tr:only-child th {\n        text-align: right;\n    }\n\n    .dataframe thead th {\n        text-align: left;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>Amplitud</th>\n      <th>Tiempo</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>-42</td>\n      <td>0.000000</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>-21</td>\n      <td>0.000023</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>1</td>\n      <td>0.000045</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>25</td>\n      <td>0.000068</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>51</td>\n      <td>0.000091</td>\n    </tr>\n    <tr>\n      <th>5</th>\n      <td>71</td>\n      <td>0.000113</td>\n    </tr>\n    <tr>\n      <th>6</th>\n      <td>90</td>\n      <td>0.000136</td>\n    </tr>\n    <tr>\n      <th>7</th>\n      <td>102</td>\n      <td>0.000159</td>\n    </tr>\n    <tr>\n      <th>8</th>\n      <td>99</td>\n      <td>0.000181</td>\n    </tr>\n    <tr>\n      <th>9</th>\n      <td>81</td>\n      <td>0.000204</td>\n    </tr>\n    <tr>\n      <th>10</th>\n      <td>59</td>\n      <td>0.000227</td>\n    </tr>\n    <tr>\n      <th>11</th>\n      <td>38</td>\n      <td>0.000249</td>\n    </tr>\n    <tr>\n      <th>12</th>\n      <td>16</td>\n      <td>0.000272</td>\n    </tr>\n    <tr>\n      <th>13</th>\n      <td>-1</td>\n      <td>0.000295</td>\n    </tr>\n    <tr>\n      <th>14</th>\n      <td>-19</td>\n      <td>0.000317</td>\n    </tr>\n    <tr>\n      <th>15</th>\n      <td>-29</td>\n      <td>0.000340</td>\n    </tr>\n    <tr>\n      <th>16</th>\n      <td>-34</td>\n      <td>0.000363</td>\n    </tr>\n    <tr>\n      <th>17</th>\n      <td>-36</td>\n      <td>0.000385</td>\n    </tr>\n    <tr>\n      <th>18</th>\n      <td>-29</td>\n      <td>0.000408</td>\n    </tr>\n    <tr>\n      <th>19</th>\n      <td>-30</td>\n      <td>0.000431</td>\n    </tr>\n    <tr>\n      <th>20</th>\n      <td>-34</td>\n      <td>0.000454</td>\n    </tr>\n    <tr>\n      <th>21</th>\n      <td>-44</td>\n      <td>0.000476</td>\n    </tr>\n    <tr>\n      <th>22</th>\n      <td>-58</td>\n      <td>0.000499</td>\n    </tr>\n    <tr>\n      <th>23</th>\n      <td>-70</td>\n      <td>0.000522</td>\n    </tr>\n    <tr>\n      <th>24</th>\n      <td>-80</td>\n      <td>0.000544</td>\n    </tr>\n    <tr>\n      <th>25</th>\n      <td>-89</td>\n      <td>0.000567</td>\n    </tr>\n    <tr>\n      <th>26</th>\n      <td>-102</td>\n      <td>0.000590</td>\n    </tr>\n    <tr>\n      <th>27</th>\n      <td>-118</td>\n      <td>0.000612</td>\n    </tr>\n    <tr>\n      <th>28</th>\n      <td>-118</td>\n      <td>0.000635</td>\n    </tr>\n    <tr>\n      <th>29</th>\n      <td>-99</td>\n      <td>0.000658</td>\n    </tr>\n    <tr>\n      <th>...</th>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>2793698</th>\n      <td>-56</td>\n      <td>63.349161</td>\n    </tr>\n    <tr>\n      <th>2793699</th>\n      <td>-52</td>\n      <td>63.349184</td>\n    </tr>\n    <tr>\n      <th>2793700</th>\n      <td>-35</td>\n      <td>63.349206</td>\n    </tr>\n    <tr>\n      <th>2793701</th>\n      <td>-21</td>\n      <td>63.349229</td>\n    </tr>\n    <tr>\n      <th>2793702</th>\n      <td>-6</td>\n      <td>63.349252</td>\n    </tr>\n    <tr>\n      <th>2793703</th>\n      <td>8</td>\n      <td>63.349274</td>\n    </tr>\n    <tr>\n      <th>2793704</th>\n      <td>10</td>\n      <td>63.349297</td>\n    </tr>\n    <tr>\n      <th>2793705</th>\n      <td>7</td>\n      <td>63.349320</td>\n    </tr>\n    <tr>\n      <th>2793706</th>\n      <td>-6</td>\n      <td>63.349342</td>\n    </tr>\n    <tr>\n      <th>2793707</th>\n      <td>-24</td>\n      <td>63.349365</td>\n    </tr>\n    <tr>\n      <th>2793708</th>\n      <td>-33</td>\n      <td>63.349388</td>\n    </tr>\n    <tr>\n      <th>2793709</th>\n      <td>-34</td>\n      <td>63.349410</td>\n    </tr>\n    <tr>\n      <th>2793710</th>\n      <td>-34</td>\n      <td>63.349433</td>\n    </tr>\n    <tr>\n      <th>2793711</th>\n      <td>-40</td>\n      <td>63.349456</td>\n    </tr>\n    <tr>\n      <th>2793712</th>\n      <td>-40</td>\n      <td>63.349478</td>\n    </tr>\n    <tr>\n      <th>2793713</th>\n      <td>-44</td>\n      <td>63.349501</td>\n    </tr>\n    <tr>\n      <th>2793714</th>\n      <td>-44</td>\n      <td>63.349524</td>\n    </tr>\n    <tr>\n      <th>2793715</th>\n      <td>-44</td>\n      <td>63.349546</td>\n    </tr>\n    <tr>\n      <th>2793716</th>\n      <td>-34</td>\n      <td>63.349569</td>\n    </tr>\n    <tr>\n      <th>2793717</th>\n      <td>-14</td>\n      <td>63.349592</td>\n    </tr>\n    <tr>\n      <th>2793718</th>\n      <td>0</td>\n      <td>63.349615</td>\n    </tr>\n    <tr>\n      <th>2793719</th>\n      <td>21</td>\n      <td>63.349637</td>\n    </tr>\n    <tr>\n      <th>2793720</th>\n      <td>36</td>\n      <td>63.349660</td>\n    </tr>\n    <tr>\n      <th>2793721</th>\n      <td>46</td>\n      <td>63.349683</td>\n    </tr>\n    <tr>\n      <th>2793722</th>\n      <td>54</td>\n      <td>63.349705</td>\n    </tr>\n    <tr>\n      <th>2793723</th>\n      <td>57</td>\n      <td>63.349728</td>\n    </tr>\n    <tr>\n      <th>2793724</th>\n      <td>63</td>\n      <td>63.349751</td>\n    </tr>\n    <tr>\n      <th>2793725</th>\n      <td>66</td>\n      <td>63.349773</td>\n    </tr>\n    <tr>\n      <th>2793726</th>\n      <td>62</td>\n      <td>63.349796</td>\n    </tr>\n    <tr>\n      <th>2793727</th>\n      <td>57</td>\n      <td>63.349819</td>\n    </tr>\n  </tbody>\n</table>\n<p>2793728 rows × 2 columns</p>\n</div>"},"exec_count":8}},"exec_count":8,"start":1511803559151,"input":"\ndf = pd.DataFrame({'Tiempo':tiempo,'Amplitud':waveData}) \ndf","scrolled":false,"state":"done","pos":22,"cell_type":"code","type":"cell","end":1511803559228,"id":"579800","kernel":"python3"}
{"exec_count":7,"start":1511806985523,"input":"# Obtiene la escala de tiempo \ntiempo = np.arange(0,len(waveData))/(sampleRate)","state":"done","pos":12,"cell_type":"code","type":"cell","end":1511806985744,"id":"cfd508","kernel":"python3"}
{"type":"cell","id":"fcc611","pos":4,"input":"### ¡Más formatos!\nLos datos obtenidos en el laboratiorio no siempre están codificados en formatos que se puedan analizar como números (por ejemplo.txt,.xls,.csv). En este caso, analizaremos un par electromiogramas (EMG) , los cuales fueron obtenidos colocando electrodos en el brazo de un voluntario, a quien se le pidió que levantara un peso mientras se realizó el registro.\n\nEstos archivos están en formato .wav, por lo que es necesario abrirlos a traves de la librería $\\textit{wave}$ para poderlos manipular:","cell_type":"markdown"}
{"type":"cell","id":"205201","pos":17,"input":"### Derivadas del voltaje\nUna forma de detectar cambios de interés en el comportamiento en los datos es calcular las derivadas discretas entre puntos sucesivos del registro. Para nuestro caso, la derivada del voltaje con respecto al tiempo es un indicador de la rapidéz con la que cambia la actividad muscular a lo largo del registro.","cell_type":"markdown"}
{"exec_count":4,"start":1511806977728,"input":"frames = record1.readframes(-1) #toma todos los frames de \"audio\", es decir, todos los puntos que corresponden a una amplitud en el registro","state":"done","pos":7,"cell_type":"code","type":"cell","end":1511806977731,"id":"60ae72","kernel":"python3"}
{"exec_count":2,"start":1511806975363,"input":"import matplotlib.pyplot as plt\nimport scipy as sc\nfrom __future__ import division, print_function\nimport numpy as np\nimport wave\nimport pandas as pd\nimport seaborn as sns","state":"done","pos":3,"cell_type":"code","type":"cell","end":1511806977082,"id":"796ede","kernel":"python3"}
{"type":"cell","id":"a63acc","pos":23,"input":"Ahora podemos seleccionar las amplitudes que nos interesan y graficarlas:","cell_type":"markdown"}
{"exec_count":3,"start":1511806977093,"input":"record1 = wave.open('Dec0.wav', 'r') ","state":"done","pos":5,"cell_type":"code","type":"cell","end":1511806977094,"id":"b2a8fd","kernel":"python3"}
{"type":"cell","id":"8182bc","pos":14,"input":"¡Ahora podemos graficar los datos!, puedes consultar un tutorial acerca de matplotlib en el siguiente link: http://mple.m-artwork.eu/tutorial","cell_type":"markdown"}
{"output":{"0":{"name":"stderr","text":"/usr/local/lib/python3.5/dist-packages/ipykernel/__main__.py:1: DeprecationWarning: Numeric-style type codes are deprecated and will result in an error in the future.\n  if __name__ == '__main__':\n"}},"exec_count":5,"start":1511806979643,"input":"waveData = np.fromstring(frames, 'Int16')  #fromstring toma la variable \"frames\" y convierte sus elementos al tipo de variable 'Int16'\n                                           #es decir, números enteros","scrolled":true,"state":"done","pos":9,"cell_type":"code","type":"cell","end":1511806979662,"id":"b90955","kernel":"python3"}
{"type":"cell","id":"4ea54b","pos":10,"input":"Un último paso antes de analizar los datos, es saber el número de canales de registro y la frecuencia de muestreo del mismo para tener una escala de tiempo adecuada:","cell_type":"markdown"}
{"output":{"0":{"data":{"text/markdown":"<font color='red'>**Jupyter Kernel terminated:**</font> This might be caused by running out of memory or hitting a bug in some library (e.g., forking too many processes, trying to access invalid memory, etc.). Consider restarting or upgrading your project or running the relevant code directly in a terminal to track down the cause, as [explained here](https://github.com/sagemathinc/cocalc/wiki/KernelTerminated)."}}},"exec_count":9,"start":1511806957425,"input":"# Plot EMG signal\nfig = plt.figure(figsize=(20, 5), dpi=100)\nplt.figure(1)\n\nplt.title('Electromiograma')\nplt.xlabel(r'tiempo [s]')\nplt.ylabel(r'voltaje [$]')\n\nplt.plot(tiempo,waveData)\n\nplt.xlim(0,max(tiempo))\nplt.show()","scrolled":false,"state":"done","pos":15,"cell_type":"code","type":"cell","end":1511806959071,"id":"6b8cba","kernel":"python3"}
{"exec_count":8,"start":1511806987231,"input":"def derive_signal(x,dt):\n    \n    l1 = len(x)-1\n    der_s = [-((x[i] - x[i+1])/dt) for i in range(0,l1)]\n    return der_s","state":"done","pos":18,"cell_type":"code","type":"cell","end":1511806987236,"id":"6e8f57","kernel":"python3"}
{"type":"cell","id":"a67c40","pos":8,"input":"Es posible ver que frames tiene un formato de tipo string, es decir, interpretado como texto, para que Python pueda interpretarlo como números, necesitamos hacer lo siguiente:","cell_type":"markdown"}
{"type":"cell","id":"16f2b6","pos":21,"input":"### Discriminar amplitudes\nEs posible discriminar los datos considerando solamente las amplitudes que nos interesa estudiar. En el caso de los EMGs, las amplitudes que corresponden a potenciales de acción son se encuetran en el rango de  $ 10^{2} \\mu V$. Una forma de extraer amplitudes en este rango para nuestro registro es utilizar la paquetería $\\textit{Pandas}$, que sirve para tabular y acceder a datos de forma rápida y práctica.\n\nPara hacer lo anterior, primero es necesario colocar los datos en forma de $\\textit{dataframe}$:","cell_type":"markdown"}
{"type":"cell","id":"edf268","pos":6,"input":"$\\textit{wave}$ nos permite obtener los datos de la onda de la siguiente forma:","cell_type":"markdown"}